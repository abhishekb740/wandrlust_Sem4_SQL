<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/PageCss/body.css">
    <title>Feed | Wandrlust</title>
</head>

<body>
    <!--Section: Newsfeed-->
    <div>
        <section
            style="display: flex; flex-direction: row; flex-wrap: wrap; flex: 0 1; gap: 2rem; padding: 5rem; justify-content: center;">
            <% images.forEach(function (image){ %>
                <div class="card" style="max-width: 30rem">
                    <div class="card-body">
                        <!-- Data -->
                        <div class="d-flex mb-3">
                            <a href="" style="text-decoration: none;">
                                <img src="/images/profile.png" class="border rounded-circle me-2" alt="Avatar"
                                    style="height: 40px" />
                            </a>
                            <div>
                                <a href="" class="text-dark mb-0" style="text-decoration: none;">
                                    <strong>
                                        <%= image.author.name %>
                                    </strong>
                                </a>
                                <a href="" class="text-muted d-block" style="margin-top: -6px; text-decoration: none;">
                                    <small>
                                        <%= image.createdAt.toUTCString() %>
                                    </small>
                                </a>
                            </div>
                        </div>
                        <!-- Description -->
                        <div>
                            <p>
                                <%= image.description %>
                            </p>
                        </div>
                    </div>

                    <!-- Media -->
                    <div class="bg-image hover-overlay ripple rounded-0" data-mdb-ripple-color="light">
                        <img src="data:image/<%=image.image.contentType%>;base64,
                        <%=image.image.data.toString('base64')%>" class="w-100" />
                        <a href="#!">
                            <div class="mask" style="background-color: rgba(251, 251, 251, 0.2)"></div>
                        </a>
                    </div>
                    <!-- Media -->
                    <!-- Interactions -->
                    <div class="card-body">
                        <!-- Reactions -->
                        <div class="d-flex justify-content-between mb-3">
                            <div>
                                <a href="" style="text-decoration: none;" onclick="deletePost('<%=image._id%>')">
                                    <i class="fas fa-trash text-danger"></i>
                                    <span>
                                        Delete
                                    </span>
                                </a>
                            </div>
                            <div>
                                <%= image.caption %>
                            </div>
                        </div>
                        <!-- Reactions -->

                    </div>
                    <!-- Interactions -->
                </div>
                <% }); %>
        </section>
    </div>
    <script>
        const deletePost = async (imageId) => {
            await fetch("/deletePost", {
                method: "delete",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    imageId
                })
            })
        }
    </script>
    <!--Section: Newsfeed-->
    <div hidden>
        <%- include('partials/footer') %>
    </div>
</body>

</html>